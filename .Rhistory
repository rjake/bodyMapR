map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#map_background +
map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#map_background +
map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
get_zones_cropped <-
get_zones %>%
#filter(area_before <= 10000) %>%
st_buffer(-0.02) %>%
#rbind(get_zones %>% filter(area_before > 10000) %>% st_buffer(-0.03)) %>%
mutate(area_after = as.numeric(st_area(.)*.00001))
plot(get_zones$geometry, col = "black")
plot(get_zones_cropped$geometry, col = "white", add = T)
get_points <-
get_zones_cropped %>%
st_sample(500) %>%
st_sf() %>%
st_join(get_zones_cropped, join = st_within) %>%
cbind(st_coordinates(.)) %>%
mutate(row = row_number(),
X2 = round_custom(X, 0.08),
Y2 = round_custom(Y, 0.08))
fake_data <-
get_zones %>%
distinct(part, region) %>%
as.tibble() %>%
mutate(months = list(month.abb)) %>% #, collapse = ",")) %>%
unnest(months) %>%
mutate(months = factor(months, levels = month.abb)) %>%
group_by(part,region) %>%
arrange(months) %>%
rowwise() %>%
mutate(male = abs(cumsum(sample(-5:10, 1, replace = T))),
female = abs(male + sample(-4:4, 1, replace = T))) %>%
ungroup() %>%
gather(key = gender, value = N, male:female) %>%
left_join(get_zones_cropped)
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 8.8) + ylim(8.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8)
ggplot() +
xlim(7, 8.8) + ylim(7.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
scale_fill_gradient(low = "black", high = "red")
ggplot() +
xlim(6, 8.8) + ylim(7.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 10) + ylim(7.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
get_zones <-
st_read("icd10_regions.shp", stringsAsFactors = F) %>%
filter(!is.na(region) | grepl("^[c,l,t,p]|sac", part, ignore.case = T)) %>%
#st_make_valid() %>%
st_buffer(0) %>%
#filter(part %in% c("humerus", "scapula", "clavicle", "ulna", "radius")) %>%
mutate(ord = row_number(),
area_before = as.numeric(st_area(.)*.00001)) %>%
filter(area_before > 200)
get_zones_cropped <-
get_zones %>%
#filter(area_before <= 10000) %>%
st_buffer(-0.02) %>%
#rbind(get_zones %>% filter(area_before > 10000) %>% st_buffer(-0.03)) %>%
mutate(area_after = as.numeric(st_area(.)*.00001))
set.seed(1234)
fake_data <-
get_zones %>%
distinct(part, region) %>%
as.tibble() %>%
mutate(months = list(month.abb)) %>% #, collapse = ",")) %>%
unnest(months) %>%
mutate(months = factor(months, levels = month.abb)) %>%
group_by(part,region) %>%
arrange(months) %>%
rowwise() %>%
mutate(male = abs(cumsum(sample(-5:10, 1, replace = T))),
female = abs(male + sample(-4:4, 1, replace = T))) %>%
ungroup() %>%
gather(key = gender, value = N, male:female) %>%
left_join(get_zones_cropped)
ggplot() +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
scale_fill_gradient(low = "black", high = "red")
get_zones <-
st_read("icd10_regions.shp", stringsAsFactors = F) %>%
filter(!is.na(region) | grepl("^[c,l,t,p,r,u]|sac", part, ignore.case = T)) %>%
#st_make_valid() %>%
st_buffer(0) %>%
#filter(part %in% c("humerus", "scapula", "clavicle", "ulna", "radius")) %>%
mutate(ord = row_number(),
area_before = as.numeric(st_area(.)*.00001)) %>%
filter(area_before > 200)
get_zones_cropped <-
get_zones %>%
#filter(area_before <= 10000) %>%
st_buffer(-0.02) %>%
#rbind(get_zones %>% filter(area_before > 10000) %>% st_buffer(-0.03)) %>%
mutate(area_after = as.numeric(st_area(.)*.00001))
set.seed(1234)
fake_data <-
get_zones %>%
distinct(part, region) %>%
as.tibble() %>%
mutate(months = list(month.abb)) %>% #, collapse = ",")) %>%
unnest(months) %>%
mutate(months = factor(months, levels = month.abb)) %>%
group_by(part,region) %>%
arrange(months) %>%
rowwise() %>%
mutate(male = abs(cumsum(sample(-5:10, 1, replace = T))),
female = abs(male + sample(-4:4, 1, replace = T))) %>%
ungroup() %>%
gather(key = gender, value = N, male:female) %>%
left_join(get_zones_cropped)
ggplot() +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
scale_fill_gradient(low = "black", high = "red")
ggplot() +
xlim(7, 10) + ylim(7.05, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
get_zones_cropped <-
get_zones %>%
#filter(area_before <= 10000) %>%
st_buffer(-0.01) %>%
#rbind(get_zones %>% filter(area_before > 10000) %>% st_buffer(-0.03)) %>%
mutate(area_after = as.numeric(st_area(.)*.00001))
set.seed(1234)
fake_data <-
get_zones %>%
distinct(part, region) %>%
as.tibble() %>%
mutate(months = list(month.abb)) %>% #, collapse = ",")) %>%
unnest(months) %>%
mutate(months = factor(months, levels = month.abb)) %>%
group_by(part,region) %>%
arrange(months) %>%
rowwise() %>%
mutate(male = abs(cumsum(sample(-5:10, 1, replace = T))),
female = abs(male + sample(-4:4, 1, replace = T))) %>%
ungroup() %>%
gather(key = gender, value = N, male:female) %>%
left_join(get_zones_cropped)
ggplot() +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
scale_fill_gradient(low = "black", high = "red")
ggplot() +
xlim(7, 10) + ylim(6, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 10) + ylim(6, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
theme_custom <-
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
text = element_text(size = 16),
panel.background = element_rect(fill = "white", color = "grey80"))
ggplot() +
xlim(7, 9) + ylim(6, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(7, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
#  xlim(7, 9) + ylim(7, 10.2) +
coord_map(xlim = c(7, 9),ylim = c(7, 10.2))
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8)
ggplot() +
#  xlim(7, 9) + ylim(7, 10.2) +
coord_map(xlim = c(7, 9),ylim = c(7, 10.2)) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8)
ggplot() +
#  xlim(7, 9) + ylim(7, 10.2) +
coord_cartesian(xlim = c(7, 9),ylim = c(7, 10.2)) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8)
ggplot() +
xlim(6.2, 9) + ylim(7, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6.2, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
#  map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6.2, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
background <-
st_difference(st_union(get_extent),
st_union(get_zones)) %>%
st_sf(a = 1, geom = .)
map_background <- geom_sf(data = background, fill = "grey70")
ggplot() +
xlim(7, 9) + ylim(6.2, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
map_background <- geom_sf(data = background, fill = "grey80")
ggplot() +
map_background + map_regions + map_bones +
xlim(7, 8.7) + ylim(7.9, 10.2)
ggplot() +
xlim(7, 9) + ylim(6.2, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
map_background <- geom_sf(data = background, fill = "grey85")
ggplot() +
xlim(7, 9) + ylim(6.2, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6.5, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
map_background <- geom_sf(data = background, fill = "grey90")
ggplot(fake_data) +
geom_bar(aes(months, N), stat = "identity") +
facet_grid(gender ~ part)
ggplot() +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
scale_fill_gradient(low = "black", high = "red")
ggplot() +
xlim(7, 9) + ylim(6.5, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6.5, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
#  facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
ggplot() +
xlim(7, 9) + ylim(6.5, 10.2) +
geom_sf(data = fake_data %>%
filter(months %in% month.abb[1:6]),
aes(fill = N), color = "white", alpha = .8) +
facet_grid(gender ~ months) +
scale_fill_gradient(low = "black", high = "red") +
#  scale_fill_viridis(option = "C", begin = .2, end = .9, direction = 1) +
#map_regions +
map_background +
#  map_bones +
guides(color = F) +
theme_custom
